<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.unity.game.mapper.InventoryMapper">

    <select id="GetSellThing" parameterType="map">
        update TBL_UNITY_INVEN
        set CNT = #{itemcnt}
        where PID = #{pid}
          AND ITEM_ID = #{itemid}
    </select>

    <select id="GetUserInfoFromDB" parameterType="string" resultType="map">
        SELECT CASH AS cash, CHP as chp, MAXHP as maxhp
        FROM TBL_UNITY_USERINFO
        where PID = #{param}
    </select>

    <select id="GetInventoryList" resultType="map">
        SELECT i.ITEM_ID AS itemid,
               i.NAME AS itemnm,
               i.DESC AS itemdesc,
               inv.CNT AS itemcnt,
               i.SELL_PRI as sellprice
        FROM TBL_UNITY_INVEN AS inv
                 INNER JOIN TBL_UNITY_ITEM AS i
                            ON inv.ITEM_ID = i.ITEM_ID
                                AND inv.CNT != '0'
    </select>

    <insert id="SetpurchaseInsert" parameterType="map">
        INSERT INTO TBL_UNITY_INVEN (PID, ITEM_ID , CNT, USBL,USBL_SLOT)
        values (#{pid}, #{itemid}, #{cnt}, #{usbl}, #{slot})
    </insert>

    <update id="SetpurchaseUpdate" parameterType="map">
        update TBL_UNITY_INVEN
        set CNT = #{bitem}
        where PID = #{pid}
          AND ITEM_ID = #{itemid}
    </update>

    <update id="Setpayment" parameterType="map">
        update TBL_UNITY_USERINFO
        set CASH = #{payment}
        where PID = #{pid}
    </update>

    <update id="SetCreatePayment" parameterType="map">
        update TBL_UNITY_INVEN
        set CNT = #{itemcnt}
        where PID = #{pid}
          AND ITEM_ID = #{itemid}
    </update>

    <update id="SetCreateUpdate" parameterType="map">
        update TBL_UNITY_INVEN
        set CNT = #{itemcnt}
        where PID = #{pid}
          AND ITEM_ID = #{itemid}
    </update>

    <insert id="SetCreateInsert" parameterType="map">
        INSERT INTO TBL_UNITY_INVEN (PID, ITEM_ID , CNT, USBL,USBL_SLOT)
        values (#{pid}, #{itemid}, #{itemcnt}, (select USBL from TBL_UNITY_ITEM where TBL_UNITY_ITEM.ITEM_ID =  #{itemid}),
                (SELECT tit.TYPE_NM
                 FROM TBL_UNITY_ITEM ti
                          INNER JOIN TBL_UNITY_ITEM_TYPE tit
                                     ON tit.TYPE_ID = ti.TYPE_ID
                 WHERE ti.ITEM_ID = #{itemid}));
    </insert>
</mapper>